#include <ultra64.h>
#include "sm64.h"
#include "behavior_data.h"
#include "model_ids.h"
#include "seq_ids.h"
#include "dialog_ids.h"
#include "segment_symbols.h"
#include "level_commands.h"
#include "game/level_update.h"
#include "levels/scripts.h"
#include "actors/common1.h"
#include "make_const_nonconst.h"

#include "areas/1/custom.model.inc.h"

#include "levels/rr/header.h"
#include "levels/ttc/header.h"

extern u8 _rr_segment_ESegmentRomStart[];
extern u8 _rr_segment_ESegmentRomEnd[];

const LevelScript level_rr_entry[] = {
	INIT_LEVEL(),
	LOAD_MIO0(0x07, _ttc_segment_7SegmentRomStart, _ttc_segment_7SegmentRomEnd),
	LOAD_RAW(0x1A, _ttcSegmentRomStart, _ttcSegmentRomEnd),
	LOAD_RAW(0x0E, _rr_segment_ESegmentRomStart, _rr_segment_ESegmentRomEnd),
	LOAD_MIO0(0xA, _SkyboxCustom36044480_skybox_mio0SegmentRomStart, _SkyboxCustom36044480_skybox_mio0SegmentRomEnd),
	LOAD_MIO0(8, _common0_mio0SegmentRomStart, _common0_mio0SegmentRomEnd),
	LOAD_RAW(15, _common0_geoSegmentRomStart, _common0_geoSegmentRomEnd),
	LOAD_MIO0(5, _group1_mio0SegmentRomStart, _group1_mio0SegmentRomEnd),
	LOAD_RAW(12, _group1_geoSegmentRomStart, _group1_geoSegmentRomEnd),
	LOAD_MIO0(6, _group14_mio0SegmentRomStart, _group14_mio0SegmentRomEnd),
	LOAD_RAW(13, _group14_geoSegmentRomStart, _group14_geoSegmentRomEnd),
	ALLOC_LEVEL_POOL(),
	MARIO(/*model*/ MODEL_MARIO, /*behParam*/ 0x00000001, /*beh*/ bhvMario),
	// Level Specific Models
	LOAD_MODEL_FROM_GEO(MODEL_TTC_ROTATING_CUBE,     ttc_geo_000240),
	    LOAD_MODEL_FROM_GEO(MODEL_TTC_ROTATING_PRISM,    ttc_geo_000258),
	    LOAD_MODEL_FROM_GEO(MODEL_TTC_PENDULUM,          ttc_geo_000270),
	    LOAD_MODEL_FROM_GEO(MODEL_TTC_LARGE_TREADMILL,   ttc_geo_000288),
	    LOAD_MODEL_FROM_GEO(MODEL_TTC_SMALL_TREADMILL,   ttc_geo_0002A8),
	    LOAD_MODEL_FROM_GEO(MODEL_TTC_PUSH_BLOCK,        ttc_geo_0002C8),
	    LOAD_MODEL_FROM_GEO(MODEL_TTC_ROTATING_HEXAGON,  ttc_geo_0002E0),
	    LOAD_MODEL_FROM_GEO(MODEL_TTC_ROTATING_TRIANGLE, ttc_geo_0002F8),
	    LOAD_MODEL_FROM_GEO(MODEL_TTC_PIT_BLOCK,         ttc_geo_000310),
	    LOAD_MODEL_FROM_GEO(MODEL_TTC_PIT_BLOCK_UNUSED,  ttc_geo_000328),
	    LOAD_MODEL_FROM_GEO(MODEL_TTC_ELEVATOR_PLATFORM, ttc_geo_000340),
	    LOAD_MODEL_FROM_GEO(MODEL_TTC_CLOCK_HAND,        ttc_geo_000358),
	    LOAD_MODEL_FROM_GEO(MODEL_TTC_SPINNER,           ttc_geo_000370),
	    LOAD_MODEL_FROM_GEO(MODEL_TTC_SMALL_GEAR,        ttc_geo_000388),
	    LOAD_MODEL_FROM_GEO(MODEL_TTC_LARGE_GEAR,        ttc_geo_0003A0),
	// Unspecified Models
	LOAD_MODEL_FROM_GEO(22,  warp_pipe_geo),
	LOAD_MODEL_FROM_GEO(23,  bubbly_tree_geo),
	LOAD_MODEL_FROM_GEO(24,  spiky_tree_geo),
	LOAD_MODEL_FROM_GEO(25,  snow_tree_geo),
	LOAD_MODEL_FROM_GEO(27,  palm_tree_geo),
	LOAD_MODEL_FROM_GEO(31,  metal_door_geo),
	LOAD_MODEL_FROM_GEO(32,  hazy_maze_door_geo),
	LOAD_MODEL_FROM_GEO(34,  castle_door_0_star_geo),
	LOAD_MODEL_FROM_GEO(35,  castle_door_1_star_geo),
	LOAD_MODEL_FROM_GEO(36,  castle_door_3_stars_geo),
	LOAD_MODEL_FROM_GEO(37,  key_door_geo),
	LOAD_MODEL_FROM_GEO(38,  castle_door_geo),
	// LOAD_MODEL_FROM_DL(132, 0x08025f08, 4),
	// LOAD_MODEL_FROM_DL(158, 0x0302c8a0, 4),
	// LOAD_MODEL_FROM_DL(159, 0x0302bcd0, 4),
	// LOAD_MODEL_FROM_DL(161, 0x0301cb00, 4),
	// LOAD_MODEL_FROM_DL(164, 0x04032a18, 4),
	// LOAD_MODEL_FROM_DL(201, 0x080048e0, 4),
	// LOAD_MODEL_FROM_DL(218, 0x08024bb8, 4),
	JUMP_LINK(script_func_global_1),
	JUMP_LINK(script_func_global_2),
	JUMP_LINK(script_func_global_15),
	JUMP_LINK(local_area_rr_1_),
	FREE_LEVEL_POOL(),
	MARIO_POS(1, 135, 0, 0, 0),
	CALL(/*arg*/ 0, /*func*/ lvl_init_or_update),
	CALL_LOOP(/*arg*/ 1, /*func*/ lvl_init_or_update),
	CLEAR_LEVEL(),
	SLEEP_BEFORE_EXIT(/*frames*/ 1),
	EXIT(),
};

const LevelScript local_area_rr_1_[] = {
	AREA(1, Geo_rr_1_0x2121700),
	TERRAIN(col_rr_1_0xe02b790),
	SET_BACKGROUND_MUSIC(0, 44),
	TERRAIN_TYPE(4),
	JUMP_LINK(local_objects_rr_1_),
	JUMP_LINK(local_warps_rr_1_),
	END_AREA(),
	RETURN()
};

const LevelScript local_objects_rr_1_[] = {
	OBJECT_WITH_ACTS(0, 0, 967, 0, 0, 180, 0, 0xa0000,  bhvSpinAirborneWarp, 31),
	OBJECT_WITH_ACTS(54, 0, -197, -1019, 0, 180, 0, 0x0,  bhvTTCRotatingSolid, 31),
	OBJECT_WITH_ACTS(66, -1087, 609, 607, 0, 0, 0, 0x0,  bhvTTCSpinner, 31),
	OBJECT_WITH_ACTS(64, -589, 704, 607, 0, 90, 0, 0x0,  bhvTTCElevator, 31),
	OBJECT_WITH_ACTS(56, 138, 1279, -2774, 0, 331, 0, 0x0,  bhvTTCPendulum, 31),
	OBJECT_WITH_ACTS(65, -3303, 383, -2179, 0, 0, 0, 0x0,  bhvTTC2DRotator, 31),
	OBJECT_WITH_ACTS(60, -3301, 367, -67, 0, 0, 0, 0x0,  bhvTTCCog, 31),
	OBJECT_WITH_ACTS(54, 0, -197, -621, 0, 0, 0, 0x0,  bhvTTCRotatingSolid, 31),
	OBJECT_WITH_ACTS(54, -2437, 414, 607, 0, 90, 0, 0x0,  bhvTTCRotatingSolid, 31),
	OBJECT_WITH_ACTS(55, -2039, 496, 607, 0, 270, 0, 0x10000,  bhvTTCRotatingSolid, 31),
	OBJECT_WITH_ACTS(54, -1642, 414, 607, 0, 90, 0, 0x0,  bhvTTCRotatingSolid, 31),
	OBJECT_WITH_ACTS(54, -929, 199, -2172, 0, 90, 0, 0x0,  bhvTTCRotatingSolid, 31),
	OBJECT_WITH_ACTS(54, -1327, 199, -2172, 0, 270, 0, 0x0,  bhvTTCRotatingSolid, 31),
	OBJECT_WITH_ACTS(0, 0, 1361, -111, 0, 180, 0, 0xa460000,  bhvRotatingPlatform, 31),
	OBJECT_WITH_ACTS(0, 154, 1756, -3009, 0, 270, 0, 0xa460000,  bhvRotatingPlatform, 31),
	OBJECT_WITH_ACTS(56, -2579, 1566, -3007, 0, 325, 0, 0x0,  bhvTTCPendulum, 31),
	OBJECT_WITH_ACTS(56, -2576, 1722, -55, 0, 180, 0, 0x0,  bhvTTCPendulum, 31),
	OBJECT_WITH_ACTS(56, -2623, 1760, -6163, 0, 180, 0, 0x0,  bhvTTCPendulum, 31),
	OBJECT_WITH_ACTS(56, -1282, 2106, -6522, 0, 270, 0, 0x0,  bhvTTCPendulum, 31),
	OBJECT_WITH_ACTS(60, -1282, 2176, -6522, 0, 0, 0, 0x0,  bhvTTCCog, 31),
	OBJECT_WITH_ACTS(60, -640, 2332, -6156, 0, 0, 0, 0x0,  bhvTTCCog, 31),
	OBJECT_WITH_ACTS(56, -640, 2262, -6156, 0, 0, 0, 0x0,  bhvTTCPendulum, 31),
	OBJECT_WITH_ACTS(60, 48, 2502, -6572, 0, 0, 0, 0x0,  bhvTTCCog, 31),
	OBJECT_WITH_ACTS(56, 48, 2432, -6572, 0, 90, 0, 0x0,  bhvTTCPendulum, 31),
	OBJECT_WITH_ACTS(60, 702, 2692, -6192, 0, 0, 0, 0x0,  bhvTTCCog, 31),
	OBJECT_WITH_ACTS(56, 702, 2622, -6192, 0, 180, 0, 0x0,  bhvTTCPendulum, 31),
	OBJECT_WITH_ACTS(55, 610, 2623, -5537, 0, 0, 0, 0x10000,  bhvTTCRotatingSolid, 31),
	OBJECT_WITH_ACTS(55, 528, 2656, -4952, 0, 180, 0, 0x10000,  bhvTTCRotatingSolid, 31),
	OBJECT_WITH_ACTS(55, 357, 2771, -3689, 0, 180, 0, 0x10000,  bhvTTCRotatingSolid, 31),
	OBJECT_WITH_ACTS(55, 444, 2698, -4322, 0, 0, 0, 0x10000,  bhvTTCRotatingSolid, 31),
	OBJECT_WITH_ACTS(192, -2348, 1776, -6085, 0, 0, 0, 0x0,  bhvGoomba, 31),
	OBJECT_WITH_ACTS(65, 46, 2907, -2548, 0, 0, 0, 0x0,  bhvTTC2DRotator, 31),
	OBJECT_WITH_ACTS(54, 42, 2706, -1133, 0, 0, 0, 0x0,  bhvTTCRotatingSolid, 31),
	OBJECT_WITH_ACTS(54, 42, 2906, -733, 0, 180, 0, 0x0,  bhvTTCRotatingSolid, 31),
	OBJECT_WITH_ACTS(54, 42, 3106, -333, 0, 0, 0, 0x0,  bhvTTCRotatingSolid, 31),
	OBJECT_WITH_ACTS(54, 42, 3306, 67, 0, 180, 0, 0x0,  bhvTTCRotatingSolid, 31),
	OBJECT_WITH_ACTS(54, 42, 3506, 467, 0, 0, 0, 0x0,  bhvTTCRotatingSolid, 31),
	OBJECT_WITH_ACTS(54, 42, 3706, 846, 0, 180, 0, 0x0,  bhvTTCRotatingSolid, 31),
	OBJECT_WITH_ACTS(0, -1816, 3907, 1594, 0, 0, 0, 0xcf0000,  bhvPoleGrabbing, 31),
	OBJECT_WITH_ACTS(55, -781, 3790, 1594, 0, 90, 0, 0x10000,  bhvTTCRotatingSolid, 31),
	OBJECT_WITH_ACTS(60, 46, 2921, -2548, 0, 0, 0, 0x0,  bhvTTCCog, 31),
	OBJECT_WITH_ACTS(60, -1331, 6557, -709, 0, 30, 0, 0x0,  bhvTTCCog, 31),
	OBJECT_WITH_ACTS(60, -1727, 6838, 203, 0, 0, 0, 0x0,  bhvTTCCog, 31),
	OBJECT_WITH_ACTS(60, -925, 6487, -813, 0, 0, 0, 0x0,  bhvTTCCog, 31),
	OBJECT_WITH_ACTS(55, -1792, 6580, -638, 0, 90, 0, 0x10000,  bhvTTCRotatingSolid, 31),
	OBJECT_WITH_ACTS(60, -1722, 6775, 604, 0, 30, 0, 0x0,  bhvTTCCog, 31),
	OBJECT_WITH_ACTS(56, -1799, 3773, 1644, 0, 0, 0, 0x0,  bhvTTCPendulum, 31),
	OBJECT_WITH_ACTS(56, -3721, 5755, 629, 0, 90, 0, 0x0,  bhvTTCPendulum, 31),
	OBJECT_WITH_ACTS(59, -3889, 5891, 893, 0, 90, 0, 0x0,  bhvTTCMovingBar, 31),
	OBJECT_WITH_ACTS(59, -3887, 5891, 657, 0, 90, 0, 0x0,  bhvTTCMovingBar, 31),
	OBJECT_WITH_ACTS(59, -188, 5891, -442, 0, 0, 0, 0x0,  bhvTTCMovingBar, 31),
	OBJECT_WITH_ACTS(59, -3879, 5891, 418, 0, 90, 0, 0x0,  bhvTTCMovingBar, 31),
	OBJECT_WITH_ACTS(0, -2581, 1756, -251, 0, 180, 0, 0xa460000,  bhvRotatingPlatform, 31),
	OBJECT_WITH_ACTS(0, -3103, 5779, -292, 0, 90, 0, 0x640000,  bhvRotatingPlatform, 31),
	OBJECT_WITH_ACTS(0, 2118, 4951, -3244, 0, 0, 0, 0xa0130000,  bhvRotatingPlatform, 31),
	OBJECT_WITH_ACTS(0, -4864, 1975, -3006, 0, 90, 0, 0xb0000,  bhvWarp, 31),
	OBJECT_WITH_ACTS(0, -2583, 1971, 471, 0, 180, 0, 0xc0000,  bhvWarp, 31),
	OBJECT_WITH_ACTS(0, -1818, 7151, 1590, 0, 180, 0, 0xd0000,  bhvWarp, 31),
	OBJECT_WITH_ACTS(0, 2119, 5144, -3960, 0, 0, 0, 0xe0000,  bhvWarp, 31),
	OBJECT_WITH_ACTS(63, 5, 0, -1524, 0, 0, 0, 0x0,  bhvThwomp2, 31),
	OBJECT_WITH_ACTS(63, -3289, 409, 624, 0, 0, 0, 0x0,  bhvThwomp2, 31),
	OBJECT_WITH_ACTS(63, -2584, 1776, -3008, 0, 90, 0, 0x4b0000,  bhvThwomp2, 31),
	OBJECT_WITH_ACTS(63, -2627, 1975, -6542, 0, 0, 0, 0x0,  bhvThwomp2, 31),
	OBJECT_WITH_ACTS(63, 357, 2907, -2996, 0, 0, 0, 0x0,  bhvThwomp2, 31),
	OBJECT_WITH_ACTS(63, 162, 6205, -692, 0, 0, 0, 0x0,  bhvThwomp2, 31),
	OBJECT_WITH_ACTS(54, 1432, 2684, -2543, 0, 90, 0, 0x0,  bhvTTCRotatingSolid, 31),
	OBJECT_WITH_ACTS(54, 912, 2684, -2541, 0, 270, 0, 0x0,  bhvTTCRotatingSolid, 31),
	OBJECT_WITH_ACTS(64, 3320, 2841, -2547, 0, 90, 0, 0x0,  bhvTTCElevator, 31),
	OBJECT_WITH_ACTS(215, 2021, 2907, -1672, 0, 180, 0, 0x0,  bhvRedCoin, 31),
	OBJECT_WITH_ACTS(215, 2027, 2907, -2550, 0, 180, 0, 0x0,  bhvRedCoin, 31),
	OBJECT_WITH_ACTS(215, 2026, 2907, -3440, 0, 180, 0, 0x0,  bhvRedCoin, 31),
	OBJECT_WITH_ACTS(215, 2915, 2907, -3437, 0, 180, 0, 0x0,  bhvRedCoin, 31),
	OBJECT_WITH_ACTS(215, 3801, 2907, -3438, 0, 180, 0, 0x0,  bhvRedCoin, 31),
	OBJECT_WITH_ACTS(215, 2913, 2907, -1665, 0, 180, 0, 0x0,  bhvRedCoin, 31),
	OBJECT_WITH_ACTS(215, 3798, 2907, -1666, 0, 180, 0, 0x0,  bhvRedCoin, 31),
	OBJECT_WITH_ACTS(215, 3802, 2907, -2554, 0, 180, 0, 0x0,  bhvRedCoin, 31),
	OBJECT_WITH_ACTS(0, 2905, 3576, -2548, 0, 0, 0, 0x0,  bhvBowserCourseRedCoinStar, 31),
	OBJECT_WITH_ACTS(122, 2086, 7443, 3013, 0, 0, 0, 0x1000000,  bhvStar, 31),
	OBJECT_WITH_ACTS(0, -3303, 440, -2179, 0, 0, 0, 0x1000000,  bhvLllRotatingBlockWithFireBars, 31),
	OBJECT_WITH_ACTS(0, 2083, 7214, 1130, 0, 0, 0, 0x1000000,  bhvLllRotatingBlockWithFireBars, 31),
	//OBJECT_WITH_ACTS(0, 1, 5, 216, 9, 0, 0, 0,  editor_Scroll_Texture, 31),
	//OBJECT_WITH_ACTS(0, 1, 5, 216, 3, 0, 0, 1,  editor_Scroll_Texture, 31),
	RETURN()
};

const LevelScript local_warps_rr_1_[] = {
	WARP_NODE(10, 15, 1, 10, 0),
	WARP_NODE(11, 15, 1, 12, 0),
	WARP_NODE(12, 15, 1, 11, 0),
	WARP_NODE(13, 15, 1, 14, 0),
	WARP_NODE(14, 15, 1, 13, 0),
	WARP_NODE(240, 16, 1, 106, 0),
	WARP_NODE(241, 16, 1, 107, 0),
	WARP_NODE(0, 15, 1, 10, 0),
	WARP_NODE(1, 15, 1, 10, 0),
	WARP_NODE(2, 15, 1, 10, 0),
	WARP_NODE(3, 15, 1, 10, 0),
	WARP_NODE(4, 15, 1, 10, 0),
	WARP_NODE(5, 15, 1, 10, 0),
	WARP_NODE(6, 15, 1, 10, 0),
	RETURN()
};