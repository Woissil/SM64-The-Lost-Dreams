#include <ultra64.h>
#include "sm64.h"
#include "behavior_data.h"
#include "model_ids.h"
#include "seq_ids.h"
#include "dialog_ids.h"
#include "segment_symbols.h"
#include "level_commands.h"
#include "game/level_update.h"
#include "levels/scripts.h"
#include "actors/common1.h"
#include "make_const_nonconst.h"

#include "areas/1/custom.model.inc.h"

#include "levels/castle_grounds/header.h"
extern u8 _castle_grounds_segment_ESegmentRomStart[];
extern u8 _castle_grounds_segment_ESegmentRomEnd[];

const LevelScript level_castle_grounds_entry[] = {
	INIT_LEVEL(),
	LOAD_MIO0(0x07, _castle_grounds_segment_7SegmentRomStart, _castle_grounds_segment_7SegmentRomEnd),
	LOAD_RAW(0x1A, _castle_groundsSegmentRomStart, _castle_groundsSegmentRomEnd),
	LOAD_RAW(0x0E, _castle_grounds_segment_ESegmentRomStart, _castle_grounds_segment_ESegmentRomEnd),
	LOAD_MIO0(0xA, _water_skybox_mio0SegmentRomStart, _water_skybox_mio0SegmentRomEnd),
	LOAD_MIO0(8, _common0_mio0SegmentRomStart, _common0_mio0SegmentRomEnd),
	LOAD_RAW(15, _common0_geoSegmentRomStart, _common0_geoSegmentRomEnd),
	LOAD_MIO0(5, _group10_mio0SegmentRomStart, _group10_mio0SegmentRomEnd),
	LOAD_RAW(12, _group10_geoSegmentRomStart, _group10_geoSegmentRomEnd),
	LOAD_MIO0(6, _group15_mio0SegmentRomStart, _group15_mio0SegmentRomEnd),
	LOAD_RAW(13, _group15_geoSegmentRomStart, _group15_geoSegmentRomEnd),
	ALLOC_LEVEL_POOL(),
	MARIO(/*model*/ MODEL_MARIO, /*behParam*/ 0x00000001, /*beh*/ bhvMario),
	// Level Specific Models
	LOAD_MODEL_FROM_GEO(MODEL_LEVEL_GEOMETRY_03,           castle_grounds_geo_0006F4),
	    LOAD_MODEL_FROM_GEO(MODEL_CASTLE_GROUNDS_BUBBLY_TREE,  bubbly_tree_geo),
	    LOAD_MODEL_FROM_GEO(MODEL_CASTLE_GROUNDS_WARP_PIPE,    warp_pipe_geo),
	    LOAD_MODEL_FROM_GEO(MODEL_CASTLE_GROUNDS_CASTLE_DOOR,  castle_door_geo),
	    LOAD_MODEL_FROM_GEO(MODEL_CASTLE_GROUNDS_METAL_DOOR,   metal_door_geo),
	    LOAD_MODEL_FROM_GEO(MODEL_CASTLE_GROUNDS_VCUTM_GRILL,  castle_grounds_geo_00070C),
	    LOAD_MODEL_FROM_GEO(MODEL_CASTLE_GROUNDS_FLAG,         castle_grounds_geo_000660),
	    LOAD_MODEL_FROM_GEO(MODEL_CASTLE_GROUNDS_CANNON_GRILL, castle_grounds_geo_000724),
	// Unspecified Models
	LOAD_MODEL_FROM_GEO(22,  warp_pipe_geo),
	LOAD_MODEL_FROM_GEO(23,  bubbly_tree_geo),
	LOAD_MODEL_FROM_GEO(24,  spiky_tree_geo),
	LOAD_MODEL_FROM_GEO(25,  snow_tree_geo),
	LOAD_MODEL_FROM_GEO(27,  palm_tree_geo),
	LOAD_MODEL_FROM_GEO(31,  metal_door_geo),
	LOAD_MODEL_FROM_GEO(32,  hazy_maze_door_geo),
	LOAD_MODEL_FROM_GEO(34,  castle_door_0_star_geo),
	LOAD_MODEL_FROM_GEO(35,  castle_door_1_star_geo),
	LOAD_MODEL_FROM_GEO(36,  castle_door_3_stars_geo),
	LOAD_MODEL_FROM_GEO(37,  key_door_geo),
	LOAD_MODEL_FROM_GEO(38,  castle_door_geo),
	LOAD_MODEL_FROM_GEO(41,  metal_door_geo),
	// LOAD_MODEL_FROM_DL(132, 0x08025f08, 4),
	// LOAD_MODEL_FROM_DL(158, 0x0302c8a0, 4),
	// LOAD_MODEL_FROM_DL(159, 0x0302bcd0, 4),
	// LOAD_MODEL_FROM_DL(161, 0x0301cb00, 4),
	// LOAD_MODEL_FROM_DL(164, 0x04032a18, 4),
	// LOAD_MODEL_FROM_DL(201, 0x080048e0, 4),
	// LOAD_MODEL_FROM_DL(218, 0x08024bb8, 4),
	JUMP_LINK(script_func_global_1),
	JUMP_LINK(script_func_global_11),
	JUMP_LINK(script_func_global_16),
	JUMP_LINK(local_area_castle_grounds_1_),
	FREE_LEVEL_POOL(),
	MARIO_POS(1, 90, -10608, -2628, 1325),
	CALL(/*arg*/ 0, /*func*/ lvl_init_or_update),
	CALL_LOOP(/*arg*/ 1, /*func*/ lvl_init_or_update),
	CLEAR_LEVEL(),
	SLEEP_BEFORE_EXIT(/*frames*/ 1),
	EXIT(),
};

const LevelScript local_area_castle_grounds_1_[] = {
	AREA(1, Geo_castle_grounds_1_0x2281700),
	TERRAIN(col_castle_grounds_1_0xe073e40),
	SET_BACKGROUND_MUSIC(0, 8),
	TERRAIN_TYPE(0),
	JUMP_LINK(local_objects_castle_grounds_1_),
	JUMP_LINK(local_warps_castle_grounds_1_),
	END_AREA(),
	RETURN()
};

const LevelScript local_objects_castle_grounds_1_[] = {
	OBJECT_WITH_ACTS(0, 3933, -3161, 1021, 0, 270, 0, 0x30000,  bhvDeathWarp, 31),
	OBJECT_WITH_ACTS(0, 3933, -3161, 1021, 0, 180, 0, 0x80000,  bhvInstantActiveWarp, 31),
	OBJECT_WITH_ACTS(124, -4864, -2937, 3724, 0, 147, 0, 0x80000,  bhvSunkenShipPart2, 31),
	OBJECT_WITH_ACTS(0, -11092, -2979, -1664, 0, 107, 0, 0xd0000,  bhvWarp, 31),
	OBJECT_WITH_ACTS(0, -9025, -3012, 8685, 0, 191, 0, 0xe0000,  bhvWarp, 31),
	OBJECT_WITH_ACTS(37, 10440, -3215, -3244, 0, 270, 0, 0x1000000,  bhvDoorWarp, 31),
	OBJECT_WITH_ACTS(37, 10440, -3215, -3092, 0, 90, 0, 0x1010000,  bhvDoorWarp, 31),
	OBJECT_WITH_ACTS(23, 6947, -3215, -7451, 0, 0, 0, 0x0,  bhvTree, 31),
	OBJECT_WITH_ACTS(35, 5143, -3215, 2577, 0, 196, 0, 0x1000000,  bhvDoor, 31),
	OBJECT_WITH_ACTS(0, -9330, -2060, 2617, 0, 0, 0, 0x0,  bhvWaterfallSoundLoop, 31),
	OBJECT_WITH_ACTS(0, -6658, -2100, 4203, 0, 0, 0, 0x0,  bhvWaterfallSoundLoop, 31),
	OBJECT_WITH_ACTS(0, 1950, -2142, -8746, 0, 0, 0, 0x0,  bhvWaterfallSoundLoop, 31),
	OBJECT_WITH_ACTS(0, -776, -753, 8994, 0, 0, 0, 0x0,  bhvWaterfallSoundLoop, 31),
	OBJECT_WITH_ACTS(142, -9592, -3340, 2243, 0, 0, 0, 0x0,  bhvWaterMist2, 31),
	OBJECT_WITH_ACTS(142, -9145, -3340, 2264, 0, 0, 0, 0x10000,  bhvWaterMist2, 31),
	OBJECT_WITH_ACTS(142, -6813, -3340, 3609, 0, 0, 0, 0x20000,  bhvWaterMist2, 31),
	OBJECT_WITH_ACTS(142, -6358, -3340, 3846, 0, 0, 0, 0x30000,  bhvWaterMist2, 31),
	OBJECT_WITH_ACTS(142, 2038, -3340, -8290, 0, 0, 0, 0x40000,  bhvWaterMist2, 31),
	OBJECT_WITH_ACTS(142, 2356, -3340, -8531, 0, 0, 0, 0x50000,  bhvWaterMist2, 31),
	OBJECT_WITH_ACTS(142, -896, -2242, 8537, 0, 0, 0, 0x60000,  bhvWaterMist2, 31),
	OBJECT_WITH_ACTS(142, -450, -2242, 8637, 0, 0, 0, 0x70000,  bhvWaterMist2, 31),
	OBJECT_WITH_ACTS(142, -7926, -3340, 6546, 0, 265, 0, 0x80000,  bhvWaterMist2, 31),
	OBJECT_WITH_ACTS(23, 532, -2316, 2576, 0, 0, 0, 0x0,  bhvTree, 31),
	OBJECT_WITH_ACTS(23, 1498, -2244, 262, 0, 0, 0, 0x0,  bhvTree, 31),
	OBJECT_WITH_ACTS(23, -2919, -2831, 1060, 0, 0, 0, 0x0,  bhvTree, 31),
	OBJECT_WITH_ACTS(23, 4802, -3215, -4864, 0, 0, 0, 0x0,  bhvTree, 31),
	OBJECT_WITH_ACTS(23, 3368, -3215, 2056, 0, 0, 0, 0x0,  bhvTree, 31),
	OBJECT_WITH_ACTS(23, 5853, -3215, 1044, 0, 0, 0, 0x0,  bhvTree, 31),
	OBJECT_WITH_ACTS(23, 6461, -3215, 5404, 0, 0, 0, 0x0,  bhvTree, 31),
	OBJECT_WITH_ACTS(23, 7429, -3215, 8001, 0, 0, 0, 0x0,  bhvTree, 31),
	OBJECT_WITH_ACTS(23, 5607, -3198, 8336, 0, 0, 0, 0x0,  bhvTree, 31),
	OBJECT_WITH_ACTS(23, 1304, -2095, 5962, 0, 0, 0, 0x0,  bhvTree, 31),
	OBJECT_WITH_ACTS(23, 3630, -3130, 8331, 0, 0, 0, 0x0,  bhvTree, 31),
	OBJECT_WITH_ACTS(23, 3175, -3125, 4944, 0, 0, 0, 0x0,  bhvTree, 31),
	OBJECT_WITH_ACTS(23, -5540, -3259, 96, 0, 0, 0, 0x0,  bhvTree, 31),
	OBJECT_WITH_ACTS(23, -4696, -3196, -5160, 0, 0, 0, 0x0,  bhvTree, 31),
	OBJECT_WITH_ACTS(23, -6719, -2961, -4222, 0, 0, 0, 0x0,  bhvTree, 31),
	OBJECT_WITH_ACTS(23, -9467, -2846, -4017, 0, 0, 0, 0x0,  bhvTree, 31),
	OBJECT_WITH_ACTS(23, -10932, -3253, 6818, 0, 0, 0, 0x0,  bhvTree, 31),
	OBJECT_WITH_ACTS(23, -10398, -3253, 8444, 0, 0, 0, 0x0,  bhvTree, 31),
	OBJECT_WITH_ACTS(23, 8126, -3189, -1004, 0, 0, 0, 0x0,  bhvTree, 31),
	OBJECT_WITH_ACTS(23, 8209, -3215, -5360, 0, 0, 0, 0x0,  bhvTree, 31),
	OBJECT_WITH_ACTS(23, -3394, -2005, 6108, 0, 0, 0, 0x0,  bhvTree, 31),
	OBJECT_WITH_ACTS(23, 2381, -3215, -2157, 0, 0, 0, 0x0,  bhvTree, 31),
	OBJECT_WITH_ACTS(0, -4865, -1956, 2028, 0, 0, 0, 0x0,  bhvBirdsSoundLoop, 31),
	OBJECT_WITH_ACTS(0, -5440, -1802, -4425, 0, 0, 0, 0x0,  bhvBirdsSoundLoop, 31),
	OBJECT_WITH_ACTS(0, -9141, -1313, -4703, 0, 0, 0, 0x0,  bhvBirdsSoundLoop, 31),
	OBJECT_WITH_ACTS(0, 3982, -1839, -6068, 0, 0, 0, 0x0,  bhvBirdsSoundLoop, 31),
	OBJECT_WITH_ACTS(23, -1561, -2608, 2891, 0, 0, 0, 0x0,  bhvTree, 31),
	OBJECT_WITH_ACTS(0, 4008, -1236, 6729, 0, 0, 0, 0x0,  bhvBirdsSoundLoop, 31),
	OBJECT_WITH_ACTS(34, -4456, -2937, 3895, 0, 180, 0, 0x20000,  bhvDoorWarp, 31),
	OBJECT_WITH_ACTS(0, 3933, -2291, 1021, 0, 180, 0, 0x8d0000,  bhvInstantActiveWarp, 31),
	OBJECT_WITH_ACTS(0, 3933, -2266, 1021, 0, 0, 0, 0x40000,  bhvAirborneStarCollectWarp, 31),
	OBJECT_WITH_ACTS(0, -3405, -1541, 7248, 0, 270, 0, 0x50000,  bhvWarpPipe, 31),
	OBJECT_WITH_ACTS(41, -11084, -2846, -4562, 0, 270, 0, 0x60000,  bhvDoorWarp, 31),
	OBJECT_WITH_ACTS(221, -9957, -3253, 6060, 0, 50, 0, 0x89000000,  bhvToadMessage, 31),
	OBJECT_WITH_ACTS(31, -4413, -3200, -2499, 0, 0, 0, 0x8000000,  bhvDoor, 31),
	OBJECT_WITH_ACTS(0, -7372, -2846, -5055, 0, 0, 0, 0x0,  bhvGoombaTripletSpawner, 31),
	OBJECT_WITH_ACTS(31, 9588, -1275, 2040, 0, 271, 0, 0x80000,  bhvDoorWarp, 31),
	OBJECT_WITH_ACTS(31, 7473, -1275, 4263, 0, 346, 0, 0x3000000,  bhvDoor, 31),
	OBJECT_WITH_ACTS(41, -2520, -2782, -129, 0, 270, 0, 0x3000000,  bhvDoor, 31),
	OBJECT_WITH_ACTS(124, 3573, -3213, -3501, 0, 28, 0, 0x930000,  bhvSunkenShipPart2, 31),
	OBJECT_WITH_ACTS(0, 2838, -1649, 4155, 0, 0, 0, 0x70000,  bhvExclamationBox, 31),
	OBJECT_WITH_ACTS(0, -1584, -2432, -5254, 0, 0, 0, 0x70000,  bhvWarpPipe, 31),
	OBJECT_WITH_ACTS(27, 1192, -3215, -4805, 0, 180, 0, 0x0,  bhvTree, 31),
	OBJECT_WITH_ACTS(137, -7742, -2882, 474, 0, 0, 0, 0x20000,  bhvExclamationBox, 31),
	OBJECT_WITH_ACTS(37, 6261, -3215, -8582, 0, 0, 0, 0x2690000,  bhvDoorWarp, 31),
	OBJECT_WITH_ACTS(37, 6413, -3215, -8582, 0, 180, 0, 0x2700000,  bhvDoorWarp, 31),
	OBJECT_WITH_ACTS(142, -7901, -3342, 6380, 0, 274, 0, 0x90000,  bhvWaterMist2, 31),
	OBJECT_WITH_ACTS(3, 9449, -2919, 6926, 0, 0, 0, 0x280000,  bhvHiddenAt120Stars, 31),
	OBJECT_WITH_ACTS(0, -4093, -2850, 3581, 0, 0, 0, 0x1a0000,  bhvAirborneStarCollectWarp, 31),
	OBJECT_WITH_ACTS(0, -4093, -2850, 3581, 0, 180, 0, 0x1b0000,  bhvDeathWarp, 31),
	OBJECT_WITH_ACTS(0, -2648, -1751, 7163, 0, 270, 0, 0x2a0000,  bhvAirborneStarCollectWarp, 31),
	OBJECT_WITH_ACTS(0, -2648, -1751, 7163, 0, 90, 0, 0x2b0000,  bhvDeathWarp, 31),
	OBJECT_WITH_ACTS(0, -1582, -2534, -4811, 0, 180, 0, 0x3a0000,  bhvAirborneStarCollectWarp, 31),
	OBJECT_WITH_ACTS(0, -1582, -2534, -4811, 0, 0, 0, 0x3b0000,  bhvDeathWarp, 31),
	OBJECT_WITH_ACTS(0, 7429, -1194, 4647, 0, 170, 0, 0x4a0000,  bhvAirborneStarCollectWarp, 31),
	OBJECT_WITH_ACTS(0, 7429, -1194, 4647, 0, 350, 0, 0x4b0000,  bhvDeathWarp, 31),
	OBJECT_WITH_ACTS(0, -10136, -2738, -4638, 0, 270, 0, 0x5a0000,  bhvAirborneStarCollectWarp, 31),
	OBJECT_WITH_ACTS(0, -10136, -2738, -4638, 0, 90, 0, 0x5b0000,  bhvDeathWarp, 31),
	OBJECT_WITH_ACTS(0, 11256, -2917, 6921, 0, 90, 0, 0x6a0000,  bhvAirborneStarCollectWarp, 31),
	OBJECT_WITH_ACTS(0, 11256, -2917, 6921, 0, 270, 0, 0x6b0000,  bhvDeathWarp, 31),
	OBJECT_WITH_ACTS(0, 2966, 5910, -7274, 0, 49, 0, 0x7a0000,  bhvAirborneWarp, 31),
	OBJECT_WITH_ACTS(0, 11596, -2916, 6921, 0, 0, 0, 0x880000,  bhvWarpPipe, 31),
	OBJECT_WITH_ACTS(124, -7346, -3253, 1888, 0, 255, 0, 0x0,  bhvSunkenShipPart2, 31),
	OBJECT_WITH_ACTS(124, -4043, -3206, -2146, 0, 0, 0, 0x9e0000,  bhvSunkenShipPart2, 31),
	OBJECT_WITH_ACTS(124, 10262, -3215, -3488, 0, 288, 0, 0x9d0000,  bhvSunkenShipPart2, 31),
	OBJECT_WITH_ACTS(124, 9147, -3215, 7240, 0, 223, 0, 0x940000,  bhvSunkenShipPart2, 31),
	OBJECT_WITH_ACTS(124, 1518, -3215, -7742, 0, 39, 0, 0x5e0000,  bhvSunkenShipPart2, 31),
	OBJECT_WITH_ACTS(124, -10150, -3253, 6268, 0, 44, 0, 0x4d0000,  bhvSunkenShipPart2, 31),
	OBJECT_WITH_ACTS(55, 10967, 2987, -536, 0, 270, 0, 0x10000,  bhvCastleFlagWaving, 31),
	OBJECT_WITH_ACTS(55, 11812, 5064, -3171, 0, 270, 0, 0x280000,  bhvCastleFlagWaving, 31),
	OBJECT_WITH_ACTS(55, 10967, 2987, -5798, 0, 270, 0, 0x0,  bhvCastleFlagWaving, 31),
	OBJECT_WITH_ACTS(23, 9846, -1295, 5011, 0, 0, 0, 0x0,  bhvTree, 31),
	OBJECT_WITH_ACTS(124, -7484, -3253, 124, 0, 0, 0, 0x1e0000,  bhvSunkenShipPart2, 31),
	OBJECT_WITH_ACTS(124, -2186, -2005, 7364, 0, 89, 0, 0xf0000,  bhvSunkenShipPart2, 31),
	OBJECT_WITH_ACTS(124, -2790, -2811, -461, 0, 285, 0, 0x100000,  bhvSunkenShipPart2, 31),
	OBJECT_WITH_ACTS(124, 7749, -1273, 4480, 0, 0, 0, 0x120000,  bhvSunkenShipPart2, 31),
	OBJECT_WITH_ACTS(124, -8918, -3253, 7215, 0, 0, 0, 0x130000,  bhvSunkenShipPart2, 31),
	OBJECT_WITH_ACTS(0, -9249, -2700, 7069, 0, 180, 0, 0x1e0000,  bhvAirborneStarCollectWarp, 31),
	OBJECT_WITH_ACTS(0, -9249, -3226, 7069, 0, 180, 0, 0x1d0000,  bhvDeathWarp, 31),
	OBJECT_WITH_ACTS(0, -2715, -3110, -461, 0, 0, 0, 0x0,  bhvPushableMetalBox, 31),
	//OBJECT_WITH_ACTS(46, 3933, -3161, 1021, 0, 0, 0, 0x10000,  bhvCheckpoint_Flag_MOP, 31),
	//OBJECT_WITH_ACTS(46, 2966, 5910, -7274, 0, 0, 0, 0x10000,  bhvCheckpoint_Flag_MOP, 31),
	//OBJECT_WITH_ACTS(46, -9025, -3012, 8685, 0, 0, 0, 0x10000,  bhvCheckpoint_Flag_MOP, 31),
	//OBJECT_WITH_ACTS(46, 6339, -3215, -8529, 0, 0, 0, 0x10000,  bhvCheckpoint_Flag_MOP, 31),
	//OBJECT_WITH_ACTS(46, -10608, -3253, 1325, 0, 0, 0, 0x10000,  bhvCheckpoint_Flag_MOP, 31),
	//OBJECT_WITH_ACTS(46, -11092, -2979, -1664, 0, 0, 0, 0x10000,  bhvCheckpoint_Flag_MOP, 31),
	//OBJECT_WITH_ACTS(0, 64, 5, 102, 0, 0, 0, 38,  editor_Scroll_Texture, 31),
	RETURN()
};

const LevelScript local_warps_castle_grounds_1_[] = {
	WARP_NODE(141, 16, 1, 141, 0),
	WARP_NODE(30, 16, 1, 30, 0),
	WARP_NODE(29, 16, 1, 29, 0),
	WARP_NODE(136, 15, 1, 10, 0),
	WARP_NODE(242, 27, 1, 10, 0),
	WARP_NODE(105, 26, 1, 0, 0),
	WARP_NODE(26, 16, 1, 26, 0),
	WARP_NODE(27, 16, 1, 27, 0),
	WARP_NODE(42, 16, 1, 42, 0),
	WARP_NODE(43, 16, 1, 43, 0),
	WARP_NODE(58, 16, 1, 58, 0),
	WARP_NODE(59, 16, 1, 59, 0),
	WARP_NODE(74, 16, 1, 74, 0),
	WARP_NODE(75, 16, 1, 75, 0),
	WARP_NODE(90, 16, 1, 90, 0),
	WARP_NODE(91, 16, 1, 91, 0),
	WARP_NODE(106, 16, 1, 106, 0),
	WARP_NODE(107, 16, 1, 107, 0),
	WARP_NODE(112, 26, 1, 1, 0),
	WARP_NODE(0, 6, 1, 0, 0),
	WARP_NODE(1, 6, 1, 1, 0),
	WARP_NODE(13, 16, 1, 14, 0),
	WARP_NODE(14, 16, 1, 13, 0),
	WARP_NODE(122, 16, 1, 122, 0),
	WARP_NODE(241, 16, 1, 3, 0),
	WARP_NODE(7, 12, 1, 10, 0),
	WARP_NODE(8, 5, 1, 10, 0),
	WARP_NODE(2, 9, 1, 10, 0),
	WARP_NODE(3, 16, 1, 10, 0),
	WARP_NODE(4, 16, 1, 10, 0),
	WARP_NODE(5, 24, 1, 10, 0),
	WARP_NODE(6, 17, 1, 10, 0),
	RETURN()
};